#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include "reader.h"
#include "vm.h"

extern Obj reverse(Obj o);


int
main(int argc, char *argv[]) {
  struct VM *vm = newVM();
  loadByteCode(vm, cstr("../init.bc"));
  loadByteCode(vm, cstr("../compile.bc"));

  // (load "lib/bootstrap.cora" "")  to generate the new init.bc and compile.bc
  char *s = "../lib/bootstrap.cora";
  eval(vm,
       cons(intern("load"),
	    cons(makeString(s, strlen(s)), cons(makeString("", 0), Nil))));

  // Check the new generated bytecode can be load successfully
  loadByteCode(vm, cstr("./init.bc"));
  loadByteCode(vm, cstr("./compile.bc"));
}
